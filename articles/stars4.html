<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>4. stars data model • stars</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="4. stars data model">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">stars</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7-1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/stars1.html">1. introduction</a></li>
    <li><a class="dropdown-item" href="../articles/stars2.html">2. stars proxy objects</a></li>
    <li><a class="dropdown-item" href="../articles/stars3.html">3. stars tidyverse methods</a></li>
    <li><a class="dropdown-item" href="../articles/stars4.html">4. stars data model</a></li>
    <li><a class="dropdown-item" href="../articles/stars5.html">5. vector-raster conversions, reprojection, warping</a></li>
    <li><a class="dropdown-item" href="../articles/stars6.html">6. How `raster` functions map to `stars` functions</a></li>
    <li><a class="dropdown-item" href="../articles/stars7.html">7. Statistical modelling with stars objects</a></li>
    <li><a class="dropdown-item" href="../articles/stars8.html">8. NetCDF Proxy Workflows</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-spatial/stars/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>4. stars data model</h1>
                        <h4 data-toc-skip class="author">Edzer
Pebesma</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-spatial/stars/blob/main/vignettes/stars4.Rmd" class="external-link"><code>vignettes/stars4.Rmd</code></a></small>
      <div class="d-none name"><code>stars4.Rmd</code></div>
    </div>

    
    
<p>This vignette explains the data model of <code>stars</code> objects,
illustrated using artificial and real datasets.</p>
<div class="section level2">
<h2 id="stars-objects">Stars objects<a class="anchor" aria-label="anchor" href="#stars-objects"></a>
</h2>
<p><code>stars</code> objects consist of</p>
<ul>
<li>a (possibly empty) named list of arrays, each having named
dimensions (<code>dim</code>) attribute</li>
<li>an attribute called <code>dimensions</code> of class
<code>dimensions</code> that carries dimension metadata</li>
<li>a class name that includes <code>stars</code>
</li>
</ul>
<p>A <code>dimensions</code> object is a named list of
<code>dimension</code> elements, each describing the semantics a
dimension of the data arrays (space, time, type etc). In addition to
that, a <code>dimensions</code> object has an attribute called
<code>raster</code> of class <code>stars_raster</code>, which is a named
list with three elements:</p>
<ul>
<li>
<code>dimensions</code> length 2 character; the dimension names that
constitute a spatial raster (or NA)</li>
<li>
<code>affine</code> length 2 numeric; the two affine parameters of
the geotransform (or NA)</li>
<li>
<code>curvilinear</code> a boolean indicating whether a raster is a
curvilinear raster (or NA)</li>
</ul>
<p>The <code>affine</code> and <code>curvilinear</code> values are only
relevant in case of raster data, indicated by <code>dimensions</code> to
have non-NA values.</p>
<p>A <code>dimension</code> object describes a <em>single</em>
dimension; it is a list with named elements</p>
<ul>
<li>
<code>from</code>: (numeric length 1): the start index of the
array</li>
<li>
<code>to</code>: (numeric length 1): the end index of the array</li>
<li>
<code>offset</code>: (numeric length 1): the start coordinate (or
time) value of the first pixel (i.e., a pixel/cell boundary)</li>
<li>
<code>delta</code>: (numeric length 1): the increment, or cell
size</li>
<li>
<code>refsys</code>: (character, or <code>crs</code>): object
describing the reference system; e.g. the PROJ string, or string
<code>POSIXct</code> or <code>PCICt</code> (for 360 and 365 days/year
calendars), or object of class <code>crs</code> (containing both EPSG
code and proj4string)</li>
<li>
<code>point</code>: (logical length 1): boolean indicating whether
cells/pixels refer to areas/periods, or to points/instances (may be
NA)</li>
<li>
<code>values</code>: one of
<ul>
<li>
<code>NULL</code> (missing),</li>
<li>a vector with coordinate values (numeric, <code>POSIXct</code>,
<code>PCICt</code>, or <code>sfc</code>),</li>
<li>an object of class <code>intervals</code> (a list with two vectors,
<code>start</code> and <code>end</code>, with interval start- and
end-values), or</li>
<li>a matrix with longitudes or latitudes for all cells (in case of
curvilinear grids)</li>
</ul>
</li>
</ul>
<p><code>from</code> and <code>to</code> will usually be 1 and the
dimension size, but <code>from</code> may be larger than 1 in case a
sub-grid got was selected (or cropped).</p>
<p><code>offset</code> and <code>delta</code> only apply to
<em>regularly</em> discretized dimensions, and are <code>NA</code> if
this is not the case. If they are <code>NA</code>, dimension values may
be held in the <code>values</code> field. Rectilinear and curvilinear
grids need grid values in <code>values</code> that can be either:</p>
<ul>
<li>for rectilinear grids: irregularly <em>spaced</em> coordinate
values, or coordinate <em>intervals</em> of irregular width (a
rectilinear grid <em>can</em> have one dimension that is regular),</li>
<li>for curvilinear grids: or a matrix with grid cell centre values for
<em>all</em> row/col combinations (usually in longitude or
latitude).</li>
</ul>
<p>Alternatively, <code>values</code> can contains a set of spatial
geometries encoded in an <code>sfc</code> vector (“list-column”), in
which case we have a <a href="https://r-spatial.org/r/2022/09/12/vdc.html" class="external-link">vector data
cube</a>.</p>
</div>
<div class="section level2">
<h2 id="grid-type">Grid type<a class="anchor" aria-label="anchor" href="#grid-type"></a>
</h2>
<div class="section level3">
<h3 id="regular-grids">Regular grids<a class="anchor" aria-label="anchor" href="#regular-grids"></a>
</h3>
<p>With a very simple file created from a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn><mo>×</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">4 \times 5</annotation></semantics></math>
matrix</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/" class="external-link">stars</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, nrow <span class="op">=</span> <span class="fl">5</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">5</span>, y <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="co"># named dim</span></span>
<span><span class="op">(</span><span class="va">s</span> <span class="op">=</span> <span class="fu"><a href="../reference/st_as_stars.html">st_as_stars</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## stars object with 2 dimensions and 1 attribute</span></span>
<span><span class="co">## attribute(s):</span></span>
<span><span class="co">##     Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span><span class="co">## A1     1    5.75   10.5 10.5   15.25   20</span></span>
<span><span class="co">## dimension(s):</span></span>
<span><span class="co">##   from to offset delta point x/y</span></span>
<span><span class="co">## x    1  5      0     1 FALSE [x]</span></span>
<span><span class="co">## y    1  4      0     1 FALSE [y]</span></span></code></pre></div>
<p>we see that</p>
<ul>
<li>the rows (5) are mapped to the first dimension, the
x-coordinate</li>
<li>the columns (4) are mapped to the second dimension, the
y-coordinate</li>
<li>the <code>from</code> and <code>to</code> fields of each dimension
define a range that corresponds to the array dimension:</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">s</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## x y </span></span>
<span><span class="co">## 5 4</span></span></code></pre></div>
<ul>
<li>offset and delta specify how increasing row and column index maps to
x and y coordinate values respectively.</li>
</ul>
<p>When we plot this object, using the <code>image</code> method for
<code>stars</code> objects,</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">s</span>, text_values <span class="op">=</span> <span class="cn">TRUE</span>, axes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="stars4_files/figure-html/unnamed-chunk-3-1.png" class="r-plt" alt="" width="432"></p>
<p>we see that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(0,0)</annotation></semantics></math>
is the origin of the grid (grid corner), and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math>
the coordinate value increase from one index (row, col) to the next. It
means that consecutive matrix columns represent grid lines, going from
south to north. Grids defined this way are <strong>regular</strong>:
grid cell size is constant everywhere.</p>
<p>Many actual grid datasets have y coordinates (grid rows) going from
North to South (top to bottom); this is realised with a negative value
for <code>delta</code>. We see that the grid origin
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(0,0)</annotation></semantics></math>
did not change:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">s</span>, <span class="st">"dimensions"</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">delta</span> <span class="op">=</span> <span class="op">-</span><span class="fl">1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">s</span>, text_values <span class="op">=</span> <span class="cn">TRUE</span>, axes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="stars4_files/figure-html/unnamed-chunk-4-1.png" class="r-plt" alt="" width="432"></p>
<p>An example is the GeoTIFF carried in the package, which, as probably
all data sources read through GDAL, has a negative <code>delta</code>
for the <code>y</code>-coordinate:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tif</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"tif/L7_ETMs.tif"</span>, package <span class="op">=</span> <span class="st">"stars"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/st_dimensions.html">st_dimensions</a></span><span class="op">(</span><span class="fu"><a href="../reference/read_stars.html">read_stars</a></span><span class="op">(</span><span class="va">tif</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="st">"y"</span><span class="op">]</span></span>
<span><span class="co">##   from  to  offset delta                     refsys point</span></span>
<span><span class="co">## y    1 352 9120761 -28.5 SIRGAS 2000 / UTM zone 25S FALSE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="raster-attributes-rotated-and-sheared-grids">Raster attributes, rotated and sheared grids<a class="anchor" aria-label="anchor" href="#raster-attributes-rotated-and-sheared-grids"></a>
</h3>
<p>Dimension tables of <code>stars</code> objects carry a
<code>raster</code> attribute:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="fu"><a href="../reference/st_dimensions.html">st_dimensions</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span>, <span class="st">"raster"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## List of 4</span></span>
<span><span class="co">##  $ affine     : num [1:2] 0 0</span></span>
<span><span class="co">##  $ dimensions : chr [1:2] "x" "y"</span></span>
<span><span class="co">##  $ curvilinear: logi FALSE</span></span>
<span><span class="co">##  $ blocksizes : NULL</span></span>
<span><span class="co">##  - attr(*, "class")= chr "stars_raster"</span></span></code></pre></div>
<p>which is a list that holds</p>
<ul>
<li>
<code>dimensions</code>: character, the names of raster dimensions
(if any), as opposed to e.g. spectral, temporal or other dimensions</li>
<li>
<code>affine</code>: numeric, the affine parameters</li>
<li>
<code>curvilinear</code>: a logical indicating whether the raster is
curvilinear</li>
</ul>
<p>These fields are needed at this level, because they describe
properties of the array at a higher level than individual dimensions do:
a pair of dimensions forms a raster, both <code>affine</code> and
<code>curvilinear</code> describe how x and y <em>as a pair</em> are
derived from grid indexes (see below) when this cannot be done on a
per-dimension basis.</p>
<p>With two affine parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>a</mi><mn>1</mn></msub><annotation encoding="application/x-tex">a_1</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>a</mi><mn>2</mn></msub><annotation encoding="application/x-tex">a_2</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
coordinates are derived from (1-based) grid indexes
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>,
grid offset values
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>o</mi><mi>x</mi></msub><annotation encoding="application/x-tex">o_x</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>o</mi><mi>y</mi></msub><annotation encoding="application/x-tex">o_y</annotation></semantics></math>,
and grid cell sizes
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>d</mi><mi>x</mi></msub><annotation encoding="application/x-tex">d_x</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>d</mi><mi>y</mi></msub><annotation encoding="application/x-tex">d_y</annotation></semantics></math>
by</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><msub><mi>o</mi><mi>x</mi></msub><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>d</mi><mi>x</mi></msub><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>a</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x = o_x + (i-1) d_x + (j-1) a_1</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><msub><mi>o</mi><mi>y</mi></msub><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>a</mi><mn>2</mn></msub><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>d</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">y = o_y + (i-1) a_2 + (j-1) d_y</annotation></semantics></math>
Clearly, when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><mo>=</mo><msub><mi>a</mi><mn>2</mn></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">a_1=a_2=0</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
are entirely derived from their respective index, offset and
cellsize.</p>
<p>Note that for integer indexes, the coordinates are that of the
starting edge of a grid cell; to get the grid cell center of the top
left grid cell (in case of a negative
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>d</mi><mi>y</mi></msub><annotation encoding="application/x-tex">d_y</annotation></semantics></math>),
use
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>=</mo><mn>1.5</mn></mrow><annotation encoding="application/x-tex">i=1.5</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>=</mo><mn>1.5</mn></mrow><annotation encoding="application/x-tex">j=1.5</annotation></semantics></math>.</p>
<p>We can rotate grids by setting
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>a</mi><mn>1</mn></msub><annotation encoding="application/x-tex">a_1</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>a</mi><mn>2</mn></msub><annotation encoding="application/x-tex">a_2</annotation></semantics></math>
to a non-zero value:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">s</span>, <span class="st">"dimensions"</span><span class="op">)</span>, <span class="st">"raster"</span><span class="op">)</span><span class="op">$</span><span class="va">affine</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">s</span>, as_points <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, nbreaks <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<p><img src="stars4_files/figure-html/unnamed-chunk-7-1.png" class="r-plt" alt="" width="700"></p>
<p>The rotation angle, in degrees, is</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">atan2</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">180</span> <span class="op">/</span> <span class="va">pi</span></span>
<span><span class="co">## [1] 5.710593</span></span></code></pre></div>
<p>Sheared grids are obtained when the two rotation coefficients,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>a</mi><mn>1</mn></msub><annotation encoding="application/x-tex">a_1</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>a</mi><mn>2</mn></msub><annotation encoding="application/x-tex">a_2</annotation></semantics></math>,
are unequal:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">s</span>, <span class="st">"dimensions"</span><span class="op">)</span>, <span class="st">"raster"</span><span class="op">)</span><span class="op">$</span><span class="va">affine</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">s</span>, as_points <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, nbreaks <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<p><img src="stars4_files/figure-html/unnamed-chunk-9-1.png" class="r-plt" alt="" width="700"></p>
<p>Now, the y-axis and x-axis have different rotation in degrees of
respectively</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">atan2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">180</span> <span class="op">/</span> <span class="va">pi</span></span>
<span><span class="co">## [1]  5.710593 11.309932</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="rectilinear-grids">Rectilinear grids<a class="anchor" aria-label="anchor" href="#rectilinear-grids"></a>
</h2>
<p><a href="https://en.wikipedia.org/wiki/Regular_grid" class="external-link">Rectilinear
grids</a> have orthogonal axes, but do not have congruent (equally sized
and shaped) cells: each axis has its own irregular subdivision.</p>
<p>We can define a rectilinear grid by specifying the cell
<em>boundaries</em>, meaning for every dimension we specify <em>one
more</em> value than the dimension size:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span>  <span class="co"># 6 numbers: boundaries!</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2.2</span><span class="op">)</span> <span class="co"># 5 numbers: boundaries!</span></span>
<span><span class="op">(</span><span class="va">r</span> <span class="op">=</span> <span class="fu"><a href="../reference/st_as_stars.html">st_as_stars</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m <span class="op">=</span> <span class="va">m</span><span class="op">)</span>, dimensions <span class="op">=</span> <span class="fu"><a href="../reference/st_dimensions.html">st_dimensions</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## stars object with 2 dimensions and 1 attribute</span></span>
<span><span class="co">## attribute(s):</span></span>
<span><span class="co">##    Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span><span class="co">## m     1    5.75   10.5 10.5   15.25   20</span></span>
<span><span class="co">## dimension(s):</span></span>
<span><span class="co">##   from to point                values x/y</span></span>
<span><span class="co">## x    1  5 FALSE     [0,0.5),...,[4,5) [x]</span></span>
<span><span class="co">## y    1  4 FALSE [0.3,0.5),...,[2,2.2) [y]</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="co">## xmin ymin xmax ymax </span></span>
<span><span class="co">##  0.0  0.3  5.0  2.2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">r</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html" class="external-link">grey</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span><span class="op">/</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="stars4_files/figure-html/unnamed-chunk-11-1.png" class="r-plt" alt="" width="700"></p>
<p>Would we leave out the last value, than <code>stars</code> may come
up with a <em>different</em> cell boundary for the last cell, as this is
now derived from the width of the one-but-last cell:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>  <span class="co"># 5 numbers: offsets only!</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>   <span class="co"># 4 numbers: offsets only!</span></span>
<span><span class="op">(</span><span class="va">r</span> <span class="op">=</span> <span class="fu"><a href="../reference/st_as_stars.html">st_as_stars</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m <span class="op">=</span> <span class="va">m</span><span class="op">)</span>, dimensions <span class="op">=</span> <span class="fu"><a href="../reference/st_dimensions.html">st_dimensions</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## stars object with 2 dimensions and 1 attribute</span></span>
<span><span class="co">## attribute(s):</span></span>
<span><span class="co">##    Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span><span class="co">## m     1    5.75   10.5 10.5   15.25   20</span></span>
<span><span class="co">## dimension(s):</span></span>
<span><span class="co">##   from to point              values x/y</span></span>
<span><span class="co">## x    1  5 FALSE   [0,0.5),...,[4,6) [x]</span></span>
<span><span class="co">## y    1  4 FALSE [0.3,0.5),...,[2,3) [y]</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="co">## xmin ymin xmax ymax </span></span>
<span><span class="co">##  0.0  0.3  6.0  3.0</span></span></code></pre></div>
<p>This is not problematic if cells have a constant width, in which case
the boundaries are reduced to an <code>offset</code> and
<code>delta</code> value, irrespective whether an upper boundary is
given:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>  <span class="co"># 5 numbers: offsets only!</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2</span><span class="op">)</span>   <span class="co"># 4 numbers: offsets only!</span></span>
<span><span class="op">(</span><span class="va">r</span> <span class="op">=</span> <span class="fu"><a href="../reference/st_as_stars.html">st_as_stars</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m <span class="op">=</span> <span class="va">m</span><span class="op">)</span>, dimensions <span class="op">=</span> <span class="fu"><a href="../reference/st_dimensions.html">st_dimensions</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## stars object with 2 dimensions and 1 attribute</span></span>
<span><span class="co">## attribute(s):</span></span>
<span><span class="co">##    Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span><span class="co">## m     1    5.75   10.5 10.5   15.25   20</span></span>
<span><span class="co">## dimension(s):</span></span>
<span><span class="co">##   from to offset delta point x/y</span></span>
<span><span class="co">## x    1  5      0     1 FALSE [x]</span></span>
<span><span class="co">## y    1  4    0.5   0.5 FALSE [y]</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="co">## xmin ymin xmax ymax </span></span>
<span><span class="co">##  0.0  0.5  5.0  2.5</span></span></code></pre></div>
<p>Alternatively, one can also set the <em>cell midpoints</em> by
specifying arguments <code>cell_midpoints</code> to the
<code>st_dimensions</code> call:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="../reference/st_as_stars.html">st_as_stars</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>                <span class="fu"><a href="../reference/st_dimensions.html">st_dimensions</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">10</span><span class="op">)</span>, cell_midpoints <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>When the dimension is regular, this results in <code>offset</code>
being shifted back with half a <code>delta</code>, or else in intervals
derived from the distances between cell centers. This should obviously
not be done when cell boundaries are specified.</p>
</div>
<div class="section level2">
<h2 id="curvilinear-grids">Curvilinear grids<a class="anchor" aria-label="anchor" href="#curvilinear-grids"></a>
</h2>
<p>Curvilinear grids are grids whose grid lines are not straight. Rather
than describing the curvature parametrically, the typical (HDF5 or
NetCDF) files in which they are found have two raster layers with the
longitudes and latitudes for every corresponding pixel of remaining
layers.</p>
<p>As an example, we will use a Sentinel 5P dataset available from
package <code>starsdata</code>; this package can be installed with</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"starsdata"</span>, repos <span class="op">=</span> <span class="st">"https://cran.uni-muenster.de/pebesma/"</span><span class="op">)</span></span></code></pre></div>
<p>The dataset is found here:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">s5p</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"sentinel5p/S5P_NRTI_L2__NO2____20180717T120113_20180717T120613_03932_01_010002_20180717T125231.nc"</span>, package <span class="op">=</span> <span class="st">"starsdata"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] "/home/runner/work/_temp/Library/starsdata/sentinel5p/S5P_NRTI_L2__NO2____20180717T120113_20180717T120613_03932_01_010002_20180717T125231.nc"</span></span></code></pre></div>
<p>We can construct the curvilinear <code>stars</code> raster by calling
<code>read_stars</code> on the right sub-array:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subs</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/gdal.html" class="external-link">gdal_subdatasets</a></span><span class="op">(</span><span class="va">s5p</span><span class="op">)</span></span>
<span><span class="va">subs</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">## [1] "NETCDF:\"/home/runner/work/_temp/Library/starsdata/sentinel5p/S5P_NRTI_L2__NO2____20180717T120113_20180717T120613_03932_01_010002_20180717T125231.nc\":/PRODUCT/nitrogendioxide_tropospheric_column"</span></span></code></pre></div>
<p>For this array, we can see the GDAL metadata under item
<code>GEOLOCATION</code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/gdal.html" class="external-link">gdal_metadata</a></span><span class="op">(</span><span class="va">subs</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span>, <span class="st">"GEOLOCATION"</span><span class="op">)</span></span>
<span><span class="co">## $GEOREFERENCING_CONVENTION</span></span>
<span><span class="co">## [1] "PIXEL_CENTER"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $LINE_OFFSET</span></span>
<span><span class="co">## [1] "0"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $LINE_STEP</span></span>
<span><span class="co">## [1] "1"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $PIXEL_OFFSET</span></span>
<span><span class="co">## [1] "0"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $PIXEL_STEP</span></span>
<span><span class="co">## [1] "1"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $SRS</span></span>
<span><span class="co">## [1] "GEOGCS[\"WGS 84\",DATUM[\"WGS_1984\",SPHEROID[\"WGS 84\",6378137,298.257223563,AUTHORITY[\"EPSG\",\"7030\"]],AUTHORITY[\"EPSG\",\"6326\"]],PRIMEM[\"Greenwich\",0,AUTHORITY[\"EPSG\",\"8901\"]],UNIT[\"degree\",0.0174532925199433,AUTHORITY[\"EPSG\",\"9122\"]],AXIS[\"Latitude\",NORTH],AXIS[\"Longitude\",EAST],AUTHORITY[\"EPSG\",\"4326\"]]"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $X_BAND</span></span>
<span><span class="co">## [1] "1"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $X_DATASET</span></span>
<span><span class="co">## [1] "NETCDF:\"/home/runner/work/_temp/Library/starsdata/sentinel5p/S5P_NRTI_L2__NO2____20180717T120113_20180717T120613_03932_01_010002_20180717T125231.nc\":/PRODUCT/longitude"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Y_BAND</span></span>
<span><span class="co">## [1] "1"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Y_DATASET</span></span>
<span><span class="co">## [1] "NETCDF:\"/home/runner/work/_temp/Library/starsdata/sentinel5p/S5P_NRTI_L2__NO2____20180717T120113_20180717T120613_03932_01_010002_20180717T125231.nc\":/PRODUCT/latitude"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "gdal_metadata"</span></span></code></pre></div>
<p>which reveals where, in this dataset, the longitude and latitude
arrays are kept.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nit.c</span> <span class="op">=</span> <span class="fu"><a href="../reference/read_stars.html">read_stars</a></span><span class="op">(</span><span class="va">subs</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> </span>
<span><span class="co">## Warning in CPL_read_gdal(as.character(x), as.character(options),</span></span>
<span><span class="co">## as.character(driver), : GDAL Message 1: The dataset has several variables that</span></span>
<span><span class="co">## could be identified as vector fields, but not all share the same primary</span></span>
<span><span class="co">## dimension. Consequently they will be ignored.</span></span>
<span><span class="co">## Warning in CPL_read_gdal(as.character(x), as.character(options),</span></span>
<span><span class="co">## as.character(driver), : GDAL Message 1: The dataset has several variables that</span></span>
<span><span class="co">## could be identified as vector fields, but not all share the same primary</span></span>
<span><span class="co">## dimension. Consequently they will be ignored.</span></span>
<span><span class="co">## Warning in CPL_read_gdal(as.character(x), as.character(options),</span></span>
<span><span class="co">## as.character(driver), : GDAL Message 1: The dataset has several variables that</span></span>
<span><span class="co">## could be identified as vector fields, but not all share the same primary</span></span>
<span><span class="co">## dimension. Consequently they will be ignored.</span></span>
<span><span class="co">## Warning in CPL_read_gdal(as.character(x), as.character(options),</span></span>
<span><span class="co">## as.character(driver), : GDAL Message 1: The dataset has several variables that</span></span>
<span><span class="co">## could be identified as vector fields, but not all share the same primary</span></span>
<span><span class="co">## dimension. Consequently they will be ignored.</span></span>
<span><span class="co">## Warning in CPL_read_gdal(as.character(x), as.character(options),</span></span>
<span><span class="co">## as.character(driver), : GDAL Message 1: The dataset has several variables that</span></span>
<span><span class="co">## could be identified as vector fields, but not all share the same primary</span></span>
<span><span class="co">## dimension. Consequently they will be ignored.</span></span>
<span><span class="co">## Warning in CPL_read_gdal(as.character(x), as.character(options),</span></span>
<span><span class="co">## as.character(driver), : GDAL Message 1: The dataset has several variables that</span></span>
<span><span class="co">## could be identified as vector fields, but not all share the same primary</span></span>
<span><span class="co">## dimension. Consequently they will be ignored.</span></span>
<span><span class="co">## Warning in CPL_read_gdal(as.character(x), as.character(options),</span></span>
<span><span class="co">## as.character(driver), : GDAL Message 1: The dataset has several variables that</span></span>
<span><span class="co">## could be identified as vector fields, but not all share the same primary</span></span>
<span><span class="co">## dimension. Consequently they will be ignored.</span></span>
<span><span class="co">## Warning in CPL_read_gdal(as.character(x), as.character(options),</span></span>
<span><span class="co">## as.character(driver), : GDAL Message 1: The dataset has several variables that</span></span>
<span><span class="co">## could be identified as vector fields, but not all share the same primary</span></span>
<span><span class="co">## dimension. Consequently they will be ignored.</span></span>
<span><span class="co">## Warning in CPL_read_gdal(as.character(x), as.character(options),</span></span>
<span><span class="co">## as.character(driver), : GDAL Message 1: The dataset has several variables that</span></span>
<span><span class="co">## could be identified as vector fields, but not all share the same primary</span></span>
<span><span class="co">## dimension. Consequently they will be ignored.</span></span>
<span><span class="co">## Warning in CPL_read_gdal(as.character(x), as.character(options),</span></span>
<span><span class="co">## as.character(driver), : GDAL Message 1: The dataset has several variables that</span></span>
<span><span class="co">## could be identified as vector fields, but not all share the same primary</span></span>
<span><span class="co">## dimension. Consequently they will be ignored.</span></span>
<span><span class="va">threshold</span> <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="fl">9e+36</span>, <span class="va">mol</span><span class="op">/</span><span class="va">m</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">nit.c</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">nit.c</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">threshold</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span></span>
<span><span class="va">nit.c</span></span>
<span><span class="co">## stars object with 3 dimensions and 1 attribute</span></span>
<span><span class="co">## attribute(s):</span></span>
<span><span class="co">##                                                   Min.      1st Qu.</span></span>
<span><span class="co">## nitrogendioxide_tropospheri... [mol/m^2] -3.301083e-05 1.868205e-05</span></span>
<span><span class="co">##                                                Median         Mean      3rd Qu.</span></span>
<span><span class="co">## nitrogendioxide_tropospheri... [mol/m^2] 2.622178e-05 2.898976e-05 3.629641e-05</span></span>
<span><span class="co">##                                                  Max. NA's</span></span>
<span><span class="co">## nitrogendioxide_tropospheri... [mol/m^2] 0.0003924858  330</span></span>
<span><span class="co">## dimension(s):</span></span>
<span><span class="co">##      from  to         offset         refsys                             values</span></span>
<span><span class="co">## x       1 450             NA WGS 84 (CRS84) [450x278] -5.811 [°],...,30.95 [°]</span></span>
<span><span class="co">## y       1 278             NA WGS 84 (CRS84)  [450x278] 28.36 [°],...,51.47 [°]</span></span>
<span><span class="co">## time    1   1 2018-07-17 UTC        POSIXct                               NULL</span></span>
<span><span class="co">##      x/y</span></span>
<span><span class="co">## x    [x]</span></span>
<span><span class="co">## y    [y]</span></span>
<span><span class="co">## time    </span></span>
<span><span class="co">## curvilinear grid</span></span></code></pre></div>
<p>The curvilinear array has the actual arrays (raster layers, matrices)
with longitude and latitude values read in its dimension table. We can
plot this file:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">nit.c</span>, breaks <span class="op">=</span> <span class="st">"equal"</span>, reset <span class="op">=</span> <span class="cn">FALSE</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, as_points <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>         pch <span class="op">=</span> <span class="fl">16</span>,  logz <span class="op">=</span> <span class="cn">TRUE</span>, key.length <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">## Warning in NextMethod(): NaNs produced</span></span>
<span><span class="co">## Warning in plot.sf(x, pal = col, ...): NaNs produced</span></span>
<span><span class="fu">maps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html" class="external-link">map</a></span><span class="op">(</span><span class="st">'world'</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span></span></code></pre></div>
<p><img src="stars4_files/figure-html/unnamed-chunk-21-1.png" class="r-plt" alt="" width="700"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">nit.c</span>, breaks <span class="op">=</span> <span class="st">"equal"</span>, reset <span class="op">=</span> <span class="cn">FALSE</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, as_points <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>         border <span class="op">=</span> <span class="cn">NA</span>, logz <span class="op">=</span> <span class="cn">TRUE</span>, key.length <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">## Warning in NextMethod(): NaNs produced</span></span>
<span><span class="co">## Warning in plot.sf(x, pal = col, ...): NaNs produced</span></span>
<span><span class="fu">maps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html" class="external-link">map</a></span><span class="op">(</span><span class="st">'world'</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span></span></code></pre></div>
<p><img src="stars4_files/figure-html/unnamed-chunk-22-1.png" class="r-plt" alt="" width="700"></p>
<p>We can downsample the data by</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">nit.c_ds</span> <span class="op">=</span> <span class="fu">stars</span><span class="fu">:::</span><span class="fu"><a href="../reference/st_downsample.html">st_downsample</a></span><span class="op">(</span><span class="va">nit.c</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## stars object with 3 dimensions and 1 attribute</span></span>
<span><span class="co">## attribute(s):</span></span>
<span><span class="co">##                                                   Min.     1st Qu.       Median</span></span>
<span><span class="co">## nitrogendioxide_tropospheri... [mol/m^2] -1.847503e-05 1.85778e-05 2.700901e-05</span></span>
<span><span class="co">##                                                Mean      3rd Qu.         Max.</span></span>
<span><span class="co">## nitrogendioxide_tropospheri... [mol/m^2] 2.9113e-05 3.642568e-05 0.0001363282</span></span>
<span><span class="co">##                                          NA's</span></span>
<span><span class="co">## nitrogendioxide_tropospheri... [mol/m^2]   32</span></span>
<span><span class="co">## dimension(s):</span></span>
<span><span class="co">##      from to         offset         refsys                           values x/y</span></span>
<span><span class="co">## x       1 50             NA WGS 84 (CRS84) [50x31] -5.811 [°],...,30.14 [°] [x]</span></span>
<span><span class="co">## y       1 31             NA WGS 84 (CRS84)  [50x31] 28.78 [°],...,51.47 [°] [y]</span></span>
<span><span class="co">## time    1  1 2018-07-17 UTC        POSIXct                             NULL    </span></span>
<span><span class="co">## curvilinear grid</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">nit.c_ds</span>, breaks <span class="op">=</span> <span class="st">"equal"</span>, reset <span class="op">=</span> <span class="cn">FALSE</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, as_points <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>         pch <span class="op">=</span> <span class="fl">16</span>, logz <span class="op">=</span> <span class="cn">TRUE</span>, key.length <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">## Warning in NextMethod(): NaNs produced</span></span>
<span><span class="co">## Warning in plot.sf(x, pal = col, ...): NaNs produced</span></span>
<span><span class="fu">maps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html" class="external-link">map</a></span><span class="op">(</span><span class="st">'world'</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span></span></code></pre></div>
<p><img src="stars4_files/figure-html/unnamed-chunk-23-1.png" class="r-plt" alt="" width="700"></p>
<p>which doesn’t look nice, but plotting the cells as polygons looks
better:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">nit.c_ds</span>, breaks <span class="op">=</span> <span class="st">"equal"</span>, reset <span class="op">=</span> <span class="cn">FALSE</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, as_points <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>         border <span class="op">=</span> <span class="cn">NA</span>, logz <span class="op">=</span> <span class="cn">TRUE</span>, key.length <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">## Warning in NextMethod(): NaNs produced</span></span>
<span><span class="co">## Warning in plot.sf(x, pal = col, ...): NaNs produced</span></span>
<span><span class="fu">maps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html" class="external-link">map</a></span><span class="op">(</span><span class="st">'world'</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span></span></code></pre></div>
<p><img src="stars4_files/figure-html/unnamed-chunk-24-1.png" class="r-plt" alt="" width="700"></p>
<p>Another approach would be to warp the curvilinear grid to a regular
grid, e.g. by</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w</span> <span class="op">=</span> <span class="fu"><a href="../reference/st_warp.html">st_warp</a></span><span class="op">(</span><span class="va">nit.c</span>, crs <span class="op">=</span> <span class="fl">4326</span>, cellsize <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="co">## Warning in transform_grid_grid(st_as_stars(src), st_dimensions(dest),</span></span>
<span><span class="co">## threshold): using Euclidean distance measures on geodetic coordinates</span></span>
<span><span class="co">## threshold set to 0.108545 : set a larger value if you see missing values where there shouldn't be</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span></span></code></pre></div>
<p><img src="stars4_files/figure-html/unnamed-chunk-25-1.png" class="r-plt" alt="" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Edzer Pebesma.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
