<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Read NetCDF into stars object — read_ncdf • stars</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Read NetCDF into stars object — read_ncdf"><meta name="description" content="Read data from a file (or source) using the NetCDF library directly."><meta property="og:description" content="Read data from a file (or source) using the NetCDF library directly."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">stars</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6-7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/stars1.html">1. introduction</a></li>
    <li><a class="dropdown-item" href="../articles/stars2.html">2. stars proxy objects</a></li>
    <li><a class="dropdown-item" href="../articles/stars3.html">3. stars tidyverse methods</a></li>
    <li><a class="dropdown-item" href="../articles/stars4.html">4. stars data model</a></li>
    <li><a class="dropdown-item" href="../articles/stars5.html">5. vector-raster conversions, reprojection, warping</a></li>
    <li><a class="dropdown-item" href="../articles/stars6.html">6. How `raster` functions map to `stars` functions</a></li>
    <li><a class="dropdown-item" href="../articles/stars7.html">7. Statistical modelling with stars objects</a></li>
    <li><a class="dropdown-item" href="../articles/stars8.html">8. NetCDF Proxy Workflows</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-spatial/stars/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Read NetCDF into stars object</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-spatial/stars/blob/main/R/ncdf.R" class="external-link"><code>R/ncdf.R</code></a></small>
      <div class="d-none name"><code>read_ncdf.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Read data from a file (or source) using the NetCDF library directly.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">read_ncdf</span><span class="op">(</span></span>
<span>  <span class="va">.x</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ncsub <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  curvilinear <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>  eps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span><span class="op">)</span>,</span>
<span>  ignore_bounds <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  make_time <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  make_units <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  proxy <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  downsample <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg--x">.x<a class="anchor" aria-label="anchor" href="#arg--x"></a></dt>
<dd><p>NetCDF file or source as a character vector or an nc_proxy object.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>ignored</p></dd>


<dt id="arg-var">var<a class="anchor" aria-label="anchor" href="#arg-var"></a></dt>
<dd><p>variable name or names (they must be on matching grids)</p></dd>


<dt id="arg-ncsub">ncsub<a class="anchor" aria-label="anchor" href="#arg-ncsub"></a></dt>
<dd><p>matrix of start, count columns (see Details)</p></dd>


<dt id="arg-curvilinear">curvilinear<a class="anchor" aria-label="anchor" href="#arg-curvilinear"></a></dt>
<dd><p>length two character named vector with names of variables holding
longitude and latitude values for all raster cells. `stars` attempts to figure out appropriate
curvilinear coordinates if they are not supplied.</p></dd>


<dt id="arg-eps">eps<a class="anchor" aria-label="anchor" href="#arg-eps"></a></dt>
<dd><p>numeric; dimension value increases are considered identical when they differ less than <code>eps</code></p></dd>


<dt id="arg-ignore-bounds">ignore_bounds<a class="anchor" aria-label="anchor" href="#arg-ignore-bounds"></a></dt>
<dd><p>logical; should bounds values for dimensions, if present, be ignored?</p></dd>


<dt id="arg-make-time">make_time<a class="anchor" aria-label="anchor" href="#arg-make-time"></a></dt>
<dd><p>if <code>TRUE</code> (the default), an attempt is made to provide a date-time class from the "time" variable</p></dd>


<dt id="arg-make-units">make_units<a class="anchor" aria-label="anchor" href="#arg-make-units"></a></dt>
<dd><p>if <code>TRUE</code> (the default), an attempt is made to set the units property of each variable</p></dd>


<dt id="arg-proxy">proxy<a class="anchor" aria-label="anchor" href="#arg-proxy"></a></dt>
<dd><p>logical; if <code>TRUE</code>, an object of class <code>stars_proxy</code> is read which contains array
metadata only; if <code>FALSE</code> the full array data is read in memory. If not set, defaults to <code>TRUE</code>
when the number of cells to be read is larger than <code>options(stars.n_proxy)</code>, or to 1e8 if that option was not set.</p></dd>


<dt id="arg-downsample">downsample<a class="anchor" aria-label="anchor" href="#arg-downsample"></a></dt>
<dd><p>integer; number of cells to omit between samples along each dimension.
e.g. <code>c(1,1,2)</code> would return every other cell in x and y and every third cell
in the third dimension (z or t). If 0, no downsampling is applied. Note that this transformation
is applied AFTER NetCDF data are read using st_downsample. As such, if proxy=TRUE, this
option is ignored.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The following logic is applied to coordinates. If any coordinate axes have
regularly spaced coordinate variables they are reduced to the
offset/delta form with 'affine = c(0, 0)', otherwise the values of the coordinates
are stored and used to define a rectilinear grid.</p>
<p>If the data has two or more dimensions and the first two are regular
they are nominated as the 'raster' for plotting.</p>
<p>If the <code>curvilinear</code> argument is used it specifies the 2D arrays
containing coordinate values for the first two dimensions of the data read. It is currently
assumed that the coordinates are 2D and that they relate to the first two dimensions in
that order.</p>

<p>If <code>var</code> is not set the first set of variables on a shared grid is used.</p>
<p><code>start</code> and <code>count</code> columns of ncsub must correspond to the variable dimension (nrows)
and be valid index using <code><a href="https://rdrr.io/pkg/RNetCDF/man/var.get.nc.html" class="external-link">var.get.nc</a></code> convention (start is 1-based). If the count value
is <code>NA</code> then all steps are included. Axis order must match that of the variable/s being read.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"nc/reduced.nc"</span>, package <span class="op">=</span> <span class="st">"stars"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hypertidy/ncmeta" class="external-link">ncmeta</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span> <span class="fu">read_ncdf</span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu">read_ncdf</span><span class="op">(</span><span class="va">f</span>, var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"anom"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu">read_ncdf</span><span class="op">(</span><span class="va">f</span>, ncsub <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">12</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> no 'var' specified, using sst, anom, err, ice</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> other available variables:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  lon, lat, zlev, time</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 0-360 longitude crossing the international date line encountered.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Longitude coordinates will be 0-360 in output.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Will return stars object with 16200 cells.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> No projection information found in nc file. </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  Coordinate variable units found to be degrees, </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  assuming WGS84 Lat/Lon.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 0-360 longitude crossing the international date line encountered.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Longitude coordinates will be 0-360 in output.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Will return stars object with 16200 cells.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> No projection information found in nc file. </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  Coordinate variable units found to be degrees, </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  assuming WGS84 Lat/Lon.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> no 'var' specified, using sst, anom, err, ice</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> other available variables:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  lon, lat, zlev, time</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Will return stars object with 120 cells.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> No projection information found in nc file. </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  Coordinate variable units found to be degrees, </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  assuming WGS84 Lat/Lon.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> stars object with 4 dimensions and 4 attributes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attribute(s):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                Min. 1st Qu. Median        Mean 3rd Qu. Max. NA's</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sst [°C]      -1.39 -0.7200 -0.515 -0.53399999  -0.275 0.03   90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> anom [°C]     -1.07 -0.3625  0.195  0.05866667   0.555 0.92   90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> err [°C]       0.30  0.3000  0.300  0.30299999   0.300 0.32   90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ice [percent]  0.01  0.1100  0.170  0.20937500   0.255 0.52  104</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dimension(s):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      from to offset delta  refsys         values x/y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lon     1 10     -1     2  WGS 84           NULL [x]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lat     1 12    -90     2  WGS 84           NULL [y]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> zlev    1  1     NA    NA      NA              0    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> time    1  1     NA    NA POSIXct 1981-12-31 UTC    </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hypertidy/ncmeta" class="external-link">ncmeta</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span> <span class="co">#' precipitation data in a curvilinear NetCDF</span></span></span>
<span class="r-in"><span> <span class="va">prec_file</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"nc/test_stageiv_xyt.nc"</span>, package <span class="op">=</span> <span class="st">"stars"</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">prec</span> <span class="op">=</span> <span class="fu">read_ncdf</span><span class="op">(</span><span class="va">prec_file</span>, curvilinear <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span>, ignore_bounds <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> no 'var' specified, using Total_precipitation_surface_1_Hour_Accumulation</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> other available variables:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  lat, lon, time</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Will return stars object with 236118 cells.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> No projection information found in nc file. </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  Coordinate variable units found to be degrees, </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  assuming WGS84 Lat/Lon.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##plot(prec) ## gives error about unique breaks</span></span></span>
<span class="r-in"><span><span class="co">## remove NAs, zeros, and give a large number</span></span></span>
<span class="r-in"><span><span class="co">## of breaks (used for validating in detail)</span></span></span>
<span class="r-in"><span><span class="va">qu_0_omit</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">22</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/drop_units.html" class="external-link">drop_units</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">prec_slice</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="va">prec</span>, index <span class="op">=</span> <span class="fl">17</span>, along <span class="op">=</span> <span class="st">"time"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">prec_slice</span>, border <span class="op">=</span> <span class="cn">NA</span>, breaks <span class="op">=</span> <span class="fu">qu_0_omit</span><span class="op">(</span><span class="va">prec_slice</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, reset <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">nc</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"gpkg/nc.gpkg"</span>, package <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span>, <span class="st">"nc.gpkg"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">nc</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, reset <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="read_ncdf-1.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Edzer Pebesma.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

